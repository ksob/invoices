<%= form_for(@invoice) do |f| %>
  <% if @invoice.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@invoice.errors.count, "error") %> prohibited this invoice from being saved:</h2>

      <ul>
      <% @invoice.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :client_names %><br>
    <%= select("invoice", "client_id", @client_names_with_ids, {include_blank: 'None'}) %>
  </div>
  <div class="field">
    <%= f.label :purchase_date %><br>
    <%= f.date_select :purchase_date %>
  </div>
  <div class="field">
    <%= f.label :issue_date %><br>
    <%= f.date_select :issue_date %>
  </div>
  <div class="field">
    <%= f.label :payment_period %><br>
    <%= f.text_field :payment_period %>
  </div>
  <div class="field">
    <%= f.label :invoice_number %><br>
    <%= f.number_field :invoice_number %>
  </div>

  <table id="invoice_items" class="table table-striped">
    <span id="invoice_items_caption">Items</span>
      <th>Name</th>
      <th>Price</th>
  <% if @invoice.invoice_items.empty? %>
      <%= render "invoice_items/invoice_item", :f => f %>
  <% else %>
    <%= f.fields_for :invoice_items, 
         @invoice.invoice_items do |invoice_item| %>
      <tr>
        <td>
          <div class="field">
            <%= invoice_item.text_field :name %>
          </div>
        </td>
        <td>
          <div class="field">
            <%= invoice_item.number_field :price %>
          </div>
        </td>
      </tr>
    <% end %>
  <% end %>
  </table>
  <!-- CODE BELOW IS A HACK, the "id: 1" is added just 
      because it works, however, it could be any other 
      number as well -->
  <%= link_to "Add Item", new_ajax_invoice_item_path(id: 1), remote: true %>
  <br />
  <br />

  <div id="invoice_note">
    <% if @invoice.invoice_note.nil? %>
        <%= link_to "Add Note", new_ajax_invoice_note_path(id: 1), remote: true %>
    <% else %>
      <%= f.fields_for :invoice_note, 
           @invoice.invoice_note do |invoice_note| %>
        <tr>
          <td>
            <div class="field">
              <%= invoice_note.text_area :content, :cols => "65", :rows => "5" %>
            </div>
          </td>
        </tr>
      <% end %>
    <% end %>
  </div>
  
  <br />
  <br />

  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
